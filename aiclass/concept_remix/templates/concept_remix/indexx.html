<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üé® Concept Remix Studio</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f0f8f0 0%, #e8f5e8 50%, #f0f8f0 100%);
      color: #333333;
      text-align: center;
      min-height: 100vh;
      padding: 20px 0;
      animation: backgroundShift 6s ease-in-out infinite alternate;
    }
    
    @keyframes backgroundShift {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
      background: linear-gradient(135deg, #ffffff 0%, #f8fff8 50%, #ffffff 100%);
      border-radius: 24px;
      box-shadow: 0 8px 32px rgba(76, 175, 80, 0.12), 0 4px 20px rgba(0, 0, 0, 0.08);
      border: 2px solid rgba(76, 175, 80, 0.2);
      position: relative;
      overflow: hidden;
    }
    
    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(76, 175, 80, 0.1), transparent);
      animation: shine 3s infinite;
    }
    
    @keyframes shine {
      0% { left: -100%; }
      100% { left: 100%; }
    }
    
    h1 {
      margin: 0 0 10px 0;
      color: #2d7738;
      font-size: 2.5em;
      font-weight: 700;
      text-shadow: none;
      background: linear-gradient(135deg, #2d7738 0%, #4CAF50 50%, #2d7738 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: titleShimmer 2s ease-in-out infinite alternate;
    }
    
    @keyframes titleShimmer {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }
    
    .subtitle {
      color: #666666;
      font-size: 1.1em;
      margin-bottom: 30px;
      line-height: 1.5;
    }
    
    .input-container {
      margin: 30px 0;
      display: flex;
      flex-direction: column;
      gap: 15px;
      align-items: center;
    }
    
    input, select {
      padding: 14px 18px;
      border: 2px solid #4CAF50;
      border-radius: 12px;
      font-size: 16px;
      width: 100%;
      max-width: 400px;
      background: #ffffff;
      color: #333333;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: #2d7738;
      box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
    }
    
    input::placeholder {
      color: #999999;
    }
    
    button {
      background: linear-gradient(135deg, #4CAF50 0%, #66BB6A 50%, #4CAF50 100%);
      color: white;
      border: none;
      padding: 16px 40px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
      box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s;
    }
    
    button:hover::before {
      left: 100%;
    }
    
    button:hover {
      background: linear-gradient(135deg, #45a049 0%, #5bb85f 50%, #45a049 100%);
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(76, 175, 80, 0.4);
    }
    
    .remix-output {
      background: linear-gradient(135deg, #ffffff 0%, #f8fff8 100%);
      color: #333333;
      padding: 20px 25px;
      margin: 25px 0;
      border-radius: 16px;
      border: 2px solid #4CAF50;
      white-space: pre-wrap;
      box-shadow: 0 8px 25px rgba(76, 175, 80, 0.12), 0 3px 15px rgba(0, 0, 0, 0.08);
      text-align: center;
      line-height: 1.6;
      font-size: 1em;
      max-height: 400px;
      overflow-y: auto;
      position: relative;
      animation: resultGlow 3s ease-in-out infinite alternate;
    }
    
    .remix-output::before {
      content: '';
      position: absolute;
      top: -1px;
      left: -1px;
      right: -1px;
      bottom: -1px;
      background: linear-gradient(45deg, #4CAF50, #66BB6A, #81C784, #4CAF50);
      border-radius: 17px;
      z-index: -1;
      animation: borderGlow 4s linear infinite;
    }
    
    @keyframes resultGlow {
      0% { box-shadow: 0 8px 25px rgba(76, 175, 80, 0.12), 0 3px 15px rgba(0, 0, 0, 0.08); }
      100% { box-shadow: 0 12px 35px rgba(76, 175, 80, 0.18), 0 5px 20px rgba(0, 0, 0, 0.12); }
    }
    
    @keyframes borderGlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .voice-controls {
      margin: 20px 0;
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    
    .voice-controls button {
      background: #ffffff;
      color: #4CAF50;
      border: 2px solid #4CAF50;
      padding: 10px 20px;
      font-size: 14px;
      margin: 0;
    }
    
    .voice-controls button:hover {
      background: #4CAF50;
      color: white;
    }
    
    .examples {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 40px;
      padding: 0 20px;
    }
    
    .remix-card {
      background: linear-gradient(135deg,rgb(200, 239, 181) 0%, #f8fff8 100%);
      border: 2px solid #4CAF50;
      border-radius: 16px;
      padding: 25px 20px;
      text-align: center;
      color: #333333;
      transition: all 0.4s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    
    .remix-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(76, 175, 80, 0.05) 0%, rgba(102, 187, 106, 0.05) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .remix-card:hover::before {
      opacity: 1;
    }
    
    .remix-card:hover {
      border-color: #4CAF50;
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 15px 40px rgba(76, 175, 80, 0.2), 0 8px 20px rgba(0, 0, 0, 0.1);
    }
    
    .remix-card h3 {
      margin: 0 0 8px 0;
      color: #2d7738;
      font-size: 1.3em;
      font-weight: 600;
    }
    
    .remix-card span {
      display: block;
      font-size: 14px;
      color: #888888;
    }
    
    select option {
      background: #ffffff;
      color: #333333;
    }
    
    ::selection {
      background: #4CAF50;
      color: #ffffff;
    }
    
    @media (max-width: 600px) {
      .container {
        margin: 10px;
        padding: 30px 15px;
        border-radius: 12px;
      }
      
      .examples {
        grid-template-columns: 1fr;
        padding: 0;
      }
      
      .voice-controls {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div style="text-align: right; margin-bottom: 20px;">
  <a href="{% url 'studentdashboard' %}" 
     style="display: inline-block; background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; padding: 10px 20px; border-radius: 30px; font-weight: 600; text-decoration: none; box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3); transition: 0.3s;">
    ‚¨ÖÔ∏è Back to Dashboard
  </a>
</div>

    <h1>üé® Concept Remix Studio</h1>
    <p class="subtitle">Transform any learning concept into songs, poems, memes, or comics.<br>Boost creativity and make studying unforgettable! üéì</p>

    <form method="POST" class="input-container">
      {% csrf_token %}

      <input type="text" name="concept" placeholder="Enter a topic (e.g. Photosynthesis)" value="{{ concept }}">
      <select name="format">
        <option value="song" {% if format_type == 'song' %}selected{% endif %}>Song/Rap</option>
        <option value="poem" {% if format_type == 'poem' %}selected{% endif %}>Poem</option>
        <option value="meme" {% if format_type == 'meme' %}selected{% endif %}>Meme</option>
        <option value="comic" {% if format_type == 'comic' %}selected{% endif %}>Comic</option>
      </select>
      <button type="submit">‚ú® Generate Story</button>
    </form>

    {% if remix %}
      <div class="remix-output" id="outputText">
        {{ remix | safe }}
      </div>
      <div class="voice-controls">
        <button onclick="speakOutput()">üîä Speak</button>
        <button onclick="stopVoice()">‚õî Stop</button>
      </div>
    {% endif %}

    <div class="examples">
      <div class="remix-card">
        <h3>üî¢ Math Rap Battle</h3>
        <span>Algebra ¬∑ Song</span>
      </div>
      <div class="remix-card">
        <h3>üìö History Haiku</h3>
        <span>WWII ¬∑ Poem</span>
      </div>
      <div class="remix-card">
        <h3>üß™ Science Meme</h3>
        <span>Gravity ¬∑ Meme</span>
      </div>
      <div class="remix-card">
        <h3>üß¨ Biology Comic</h3>
        <span>DNA ¬∑ Comic</span>
      </div>
      <div class="remix-card">
        <h3>‚öó Chemistry Song</h3>
        <span>Periodic Table ¬∑ Song</span>
      </div>
      <div class="remix-card">
        <h3>üî≠ Physics Poem</h3>
        <span>Quantum Theory ¬∑ Poem</span>
      </div>
    </div>
    
  </div>

  <script>
    let currentUtterance = null;
    let currentIndex = 0;
    let audioContext = null;
    let isPlaying = false;

    // Initialize audio context for effects
    function initAudio() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
    }

    function cleanTextForSpeech(text) {
      // Remove asterisks, markdown formatting, and other unwanted characters
      return text
        .replace(/\*/g, '') // Remove all asterisks
        .replace(/_{2,}/g, '') // Remove underscores
        .replace(/#{1,}/g, '') // Remove hashtags
        .replace(/\[.*?\]/g, '') // Remove text in brackets
        .replace(/\(.*?\)/g, '') // Remove text in parentheses for cleaner speech
        .replace(/Image:/gi, '') // Remove "Image:" labels
        .replace(/Caption:/gi, '') // Remove "Caption:" labels
        .replace(/Panel \d+:/gi, '') // Remove "Panel 1:", "Panel 2:", etc.
        .replace(/\s+/g, ' ') // Replace multiple spaces with single space
        .trim();
    }

    function speakOutput() {
      const rawText = document.getElementById("outputText").innerText;
      const cleanText = cleanTextForSpeech(rawText);
      const remixType = "{{ format_type }}";
      
      speechSynthesis.cancel();
      isPlaying = true;
      
      switch (remixType) {
        case 'song':
          speakSong(cleanText);
          break;
        case 'poem':
          speakPoem(cleanText);
          break;
        case 'comic':
          speakComic(cleanText);
          break;
        case 'meme':
          speakMeme(cleanText);
          break;
        default:
          speakRegular(cleanText);
      }
    }

    function speakSong(text) {
      // Split into lines and add rhythm - more musical approach
      const lines = text.split(/[\n\r]+/).filter(line => line.trim());
      currentIndex = 0;
      
      function speakNextLine() {
        if (currentIndex >= lines.length || !isPlaying) return;
        
        const line = lines[currentIndex].trim();
        if (!line) {
          currentIndex++;
          speakNextLine();
          return;
        }
        
        currentUtterance = new SpeechSynthesisUtterance(line);
        
        // More musical song settings - faster and more rhythmic
        const beatPattern = currentIndex % 4; // 4-beat pattern
        currentUtterance.rate = 1.0 + beatPattern * 0.15; // Rhythmic variation
        currentUtterance.pitch = 1.2 + Math.sin(currentIndex * 0.5) * 0.4; // Melodic pitch
        currentUtterance.volume = 0.9;
        
        // Emphasis on certain beats
        if (beatPattern === 0 || beatPattern === 2) {
          currentUtterance.volume = 1.0; // Stronger beats
        }
        
        // Try to get the best voice for singing
        const voices = speechSynthesis.getVoices();
        const preferredVoice = voices.find(voice => 
          voice.name.includes('Female') || 
          voice.name.includes('Google UK English Female') ||
          voice.name.includes('Microsoft Zira') ||
          voice.name.includes('Samantha')
        ) || voices.find(voice => voice.lang.includes('en'));
        
        if (preferredVoice) currentUtterance.voice = preferredVoice;
        
        currentUtterance.onend = () => {
          currentIndex++;
          // Much shorter, more musical pause - like actual song rhythm
          const pauseTime = line.length < 20 ? 150 : 250; // Shorter pauses
          setTimeout(speakNextLine, pauseTime);
        };
        
        speechSynthesis.speak(currentUtterance);
      }
      
      speakNextLine();
    }

    function speakPoem(text) {
      // Dramatic poetry delivery with better pacing
      const lines = text.split(/[\n\r]+/).filter(line => line.trim());
      currentIndex = 0;
      
      function speakNextLine() {
        if (currentIndex >= lines.length || !isPlaying) return;
        
        const line = lines[currentIndex].trim();
        if (!line) {
          currentIndex++;
          speakNextLine();
          return;
        }
        
        currentUtterance = new SpeechSynthesisUtterance(line);
        
        // Dramatic but not too slow
        currentUtterance.rate = 0.7; // Slightly faster than before
        currentUtterance.pitch = 0.9; // Deeper for drama
        currentUtterance.volume = 1.0;
        
        // Prefer deeper/male voices for poems
        const voices = speechSynthesis.getVoices();
        const deepVoice = voices.find(voice => 
          voice.name.includes('Male') ||
          voice.name.includes('David') ||
          voice.name.includes('Microsoft Mark') ||
          voice.name.includes('Google UK English Male')
        ) || voices[0];
        
        if (deepVoice) currentUtterance.voice = deepVoice;
        
        currentUtterance.onend = () => {
          currentIndex++;
          // Shorter dramatic pause - still dramatic but not boring
          setTimeout(speakNextLine, 600); // Reduced from 1200ms
        };
        
        speechSynthesis.speak(currentUtterance);
      }
      
      speakNextLine();
    }

    function speakComic(text) {
      // Fun, animated comic book style
      const sentences = text.split(/[.!?]+/).filter(s => s.trim());
      currentIndex = 0;
      
      function speakNextSentence() {
        if (currentIndex >= sentences.length || !isPlaying) return;
        
        const sentence = sentences[currentIndex].trim();
        if (!sentence) {
          currentIndex++;
          speakNextSentence();
          return;
        }
        
        currentUtterance = new SpeechSynthesisUtterance(sentence);
        
        // Animated, bouncy comic style
        currentUtterance.rate = 1.1 + Math.random() * 0.4; // Varied speed
        currentUtterance.pitch = 1.3 + Math.random() * 0.4; // High, excited pitch
        currentUtterance.volume = 0.95;
        
        // Prefer energetic/young voices
        const voices = speechSynthesis.getVoices();
        const energeticVoice = voices.find(voice => 
          voice.name.includes('Female') ||
          voice.name.includes('Google US English') ||
          voice.name.includes('Microsoft Zira')
        ) || voices[0];
        
        if (energeticVoice) currentUtterance.voice = energeticVoice;
        
        currentUtterance.onend = () => {
          currentIndex++;
          // Quick comic-style pause
          setTimeout(speakNextSentence, 400);
        };
        
        speechSynthesis.speak(currentUtterance);
      }
      
      speakNextSentence();
    }

    function speakMeme(text) {
      // Casual, sarcastic meme style
      currentUtterance = new SpeechSynthesisUtterance(text);
      
      // Casual, slightly sarcastic tone
      currentUtterance.rate = 1.3; // Fast delivery
      currentUtterance.pitch = 0.9; // Slightly lower pitch
      currentUtterance.volume = 0.8;
      
      // Prefer casual/neutral voices
      const voices = speechSynthesis.getVoices();
      const casualVoice = voices.find(voice => 
        voice.name.includes('Google US English') ||
        voice.name.includes('Microsoft Mark') ||
        voice.lang.includes('en-US')
      ) || voices[0];
      
      if (casualVoice) currentUtterance.voice = casualVoice;
      
      speechSynthesis.speak(currentUtterance);
    }

    function speakRegular(text) {
      currentUtterance = new SpeechSynthesisUtterance(text);
      currentUtterance.rate = 1.0;
      currentUtterance.pitch = 1.0;
      currentUtterance.volume = 0.9;
      speechSynthesis.speak(currentUtterance);
    }

    function stopVoice() {
      speechSynthesis.cancel();
      currentUtterance = null;
      currentIndex = 0;
      isPlaying = false;
    }

    // Load voices when available
    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = () => {
        console.log('Available voices:', speechSynthesis.getVoices().length);
        // Log voice names for debugging
        speechSynthesis.getVoices().forEach(voice => {
          console.log(${voice.name} - ${voice.lang});
        });
      };
    }

    // Initialize audio on first user interaction
    document.addEventListener('click', initAudio, { once: true });
  </script>
</body>
</html>